# SmartPaste é¡¹ç›®ä»£ç ç¼–å†™è§„èŒƒ

## ä¸€ã€æ¨¡å—åŒ–æ¶æ„è§„èŒƒ

### 1.1 æ¨¡å—èŒè´£åˆ’åˆ†

#### **app_setup.rs** - åº”ç”¨åˆå§‹åŒ–å’Œç³»ç»Ÿçº§åŠŸèƒ½
  - ç³»ç»Ÿæ‰˜ç›˜è®¾ç½®å’Œç®¡ç†
  - å…¨å±€å¿«æ·é”®ç®¡ç†å’Œæ³¨å†Œ
  - å‰ªè´´æ¿ç›‘æ§ä¸»å¾ªç¯
  - åº”ç”¨çª—å£ç®¡ç†ï¼ˆæ˜¾ç¤º/éšè—/åˆ‡æ¢ï¼‰
  - åå°æ¸…ç†çº¿ç¨‹ç®¡ç†

#### **clipboard.rs** - å‰ªè´´æ¿æ•°æ®ç»“æ„å’ŒåŸºç¡€æ“ä½œ
  - `ClipboardItem` å’Œ `FolderItem` ç»“æ„ä½“å®šä¹‰
  - å‰ªè´´æ¿é¡¹ç›®çš„åºåˆ—åŒ–/ååºåˆ—åŒ–
  - å…¨å±€çŠ¶æ€ç®¡ç†ï¼ˆLAST_INSERTEDï¼‰


#### **config.rs** - é…ç½®ç®¡ç†
#####  **è´Ÿè´£åŠŸèƒ½**ï¼š
  - `Config` ç»“æ„ä½“å’Œé…ç½®é¡¹å®šä¹‰
  - é…ç½®æ–‡ä»¶è¯»å†™å’ŒæŒä¹…åŒ–
  - é…ç½®é¡¹ç±»å‹è½¬æ¢å’ŒéªŒè¯
  - å­˜å‚¨è·¯å¾„ç®¡ç†å’Œè¿ç§»

##### **è®¾è®¡åŸåˆ™**ï¼š
  - æ‰€æœ‰é…ç½®é¡¹éƒ½æœ‰é»˜è®¤å€¼
  - é…ç½®é¡¹åç§°ç»Ÿä¸€ï¼Œå‰ç«¯å’ŒRustä½¿ç”¨ç›¸åŒkey
  - æ”¯æŒè¿è¡Œæ—¶é…ç½®çƒ­æ›´æ–°

#### **db.rs** - æ•°æ®åº“æ“ä½œ
##### **è´Ÿè´£åŠŸèƒ½**ï¼š
  - SQLiteæ•°æ®åº“CRUDæ“ä½œ
  - æ•°æ®æŸ¥è¯¢å’Œç­›é€‰
  - éšç§æ•°æ®æ ‡è®°å’Œæ¸…ç†
  - æ•°æ®åº“å¤‡ä»½å’Œæ¢å¤


#### **ocr.rs** - OCRç›¸å…³åŠŸèƒ½
##### **è´Ÿè´£åŠŸèƒ½**ï¼š
  - OCRå¼•æ“åˆå§‹åŒ–å’Œé…ç½®
  - å›¾ç‰‡æ–‡å­—è¯†åˆ«
  - OCRç»“æœå¤„ç†å’Œæ ¼å¼åŒ–

##### **è®¾è®¡åŸåˆ™**ï¼š
  - ä½¿ç”¨å•ä¾‹æ¨¡å¼ç®¡ç†OCRå¼•æ“
  - æ”¯æŒå¤šç§OCRæä¾›å•†ï¼ˆTesseractã€Windows OCRç­‰ï¼‰
  - å¼‚æ­¥å¤„ç†é¿å…é˜»å¡ä¸»çº¿ç¨‹

#### **utils.rs** - é€šç”¨å·¥å…·å‡½æ•°
##### **è´Ÿè´£åŠŸèƒ½**ï¼š
  - å‰ªè´´æ¿è¯»å†™æ“ä½œ
  - æ–‡ä»¶å›¾æ ‡æå–
  - æ–‡ä»¶/æ–‡ä»¶å¤¹å¤åˆ¶å’Œç§»åŠ¨
  - è¾“å…¥è®¾å¤‡ç›‘å¬ï¼ˆé”®ç›˜/é¼ æ ‡ï¼‰
  - æ•°æ®å¯¼å‡º/å¯¼å…¥ï¼ˆZIPæ ¼å¼ï¼‰
  - Base64ç¼–ç /è§£ç 
  - è·¯å¾„å¤„ç†å’Œå®‰å…¨æ£€æŸ¥

##### **è®¾è®¡åŸåˆ™**ï¼š
  - æä¾›è·¨å¹³å°å…¼å®¹çš„å‡½æ•°
  - æ‰€æœ‰æ–‡ä»¶æ“ä½œéƒ½åŒ…å«å®‰å…¨æ£€æŸ¥
  - å¼‚æ­¥å¤„ç†è€—æ—¶æ“ä½œ

### 1.2 æ¨¡å—ä¾èµ–å…³ç³»
```
main.rs
  â”œâ”€â”€ app_setup.rs
  â”‚     â”œâ”€â”€ config.rs (åªè¯»)
  â”‚     â”œâ”€â”€ utils.rs (å‰ªè´´æ¿ç›‘æ§)
  â”‚     â””â”€â”€ db.rs (æ•°æ®ä¿å­˜)
  â”‚
  â”œâ”€â”€ clipboard.rs (æ•°æ®ç»“æ„)
  â”‚
  â”œâ”€â”€ config.rs
  â”‚
  â”œâ”€â”€ db.rs
  â”‚     â”œâ”€â”€ config.rs (è¯»å–é…ç½®)
  â”‚     â””â”€â”€ utils.rs (è·¯å¾„è§£æ)
  â”‚
  â”œâ”€â”€ ocr.rs
  â”‚     â””â”€â”€ utils.rs (æ–‡ä»¶è¯»å–)
  â”‚
  â””â”€â”€ utils.rs
```

## äºŒã€å‡½æ•°æ³¨é‡Šè§„èŒƒ

### 2.1 é€šç”¨æ³¨é‡Šæ ¼å¼

```rust
/// å‡½æ•°çš„ç®€è¦è¯´æ˜ã€‚
///
/// æ›´è¯¦ç»†çš„æè¿°ï¼Œå¯ä»¥åŒ…æ‹¬ï¼š
/// 1. å‡½æ•°çš„ä¸»è¦ä½œç”¨
/// 2. ç‰¹æ®Šå¤„ç†æˆ–æ³¨æ„äº‹é¡¹
/// 3. æ€§èƒ½è€ƒè™‘
///
/// # å‚æ•°
/// - `param1: Type` - å‚æ•°1çš„è¯¦ç»†è¯´æ˜ï¼ŒåŒ…æ‹¬ï¼š
///   - æœŸæœ›çš„å€¼èŒƒå›´
///   - ç‰¹æ®Šæ ¼å¼è¦æ±‚
///   - å¯èƒ½çš„å½±å“
/// - `param2: Type` - å‚æ•°2çš„è¯¦ç»†è¯´æ˜
///
/// # è¿”å›å€¼
/// `Result<ReturnType, String>` - è¿”å›å€¼çš„è¯´æ˜ï¼š
/// - `Ok(ReturnType)` - æˆåŠŸæ—¶çš„è¿”å›å€¼ç»“æ„
/// - `Err(String)` - å¤±è´¥æ—¶çš„é”™è¯¯ä¿¡æ¯æ ¼å¼
///
/// # ç¤ºä¾‹
/// ```rust
/// // ç®€çŸ­çš„ç¤ºä¾‹ä»£ç 
/// let result = function_name(param1, param2)?;
/// ```
///
/// # é”™è¯¯å¤„ç†
/// - `ErrorType1` - å½“XXXæ¡ä»¶ä¸æ»¡è¶³æ—¶
/// - `ErrorType2` - å½“YYYæ“ä½œå¤±è´¥æ—¶
///
/// # æ³¨æ„äº‹é¡¹
/// - ä½¿ç”¨æ—¶éœ€è¦æ³¨æ„çš„äº‹é¡¹
/// - å¯èƒ½çš„å®‰å…¨é£é™©
/// - æ€§èƒ½å½±å“
///
/// # ç›¸å…³å‡½æ•°
/// - `related_function1` - åŠŸèƒ½ç›¸å…³çš„å‡½æ•°1
/// - `related_function2` - åŠŸèƒ½ç›¸å…³çš„å‡½æ•°2
#[tauri::command]
pub fn function_name(param1: Type1, param2: Type2) -> Result<ReturnType, String> {
    // å‡½æ•°å®ç°
}
```

### 2.2 Tauri Commandæ³¨é‡Šè§„èŒƒ

```rust
/// å°†æŒ‡å®šçš„æ–‡æœ¬å†™å…¥ç³»ç»Ÿå‰ªè´´æ¿ã€‚ä½œä¸º Tauri command æš´éœ²ç»™å‰ç«¯è°ƒç”¨ã€‚
///
/// è¯¥å‡½æ•°ä¼šè®¾ç½®ä¸€ä¸ªæ ‡å¿—ï¼Œè¡¨ç¤ºè¿™æ˜¯å‰ç«¯è§¦å‘çš„å¤åˆ¶ï¼Œä»¥é¿å…å‰ªè´´æ¿ç›‘æ§å¾ªç¯ã€‚
///
/// # å‚æ•°
/// - `text: String` - è¦å†™å…¥å‰ªè´´æ¿çš„æ–‡æœ¬å†…å®¹ï¼Œé•¿åº¦ä¸é™ã€‚
/// - `_app_handle: tauri::AppHandle` - Tauri åº”ç”¨å¥æŸ„ï¼Œå½“å‰æœªä½¿ç”¨ä½†ä¿ç•™æ¥å£ã€‚
/// - `state: State<'_, ClipboardSourceState>` - å‰ªè´´æ¿æ¥æºçŠ¶æ€ï¼Œç”¨äºæ ‡è®°å‰ç«¯å¤åˆ¶ã€‚
///
/// # è¿”å›å€¼
/// - `Ok(())` - æ“ä½œæˆåŠŸï¼Œæ— è¿”å›å€¼ã€‚
/// - `Err(String)` - æ“ä½œå¤±è´¥ï¼Œè¿”å›é”™è¯¯ä¿¡æ¯å­—ç¬¦ä¸²ã€‚
///
/// # ç¤ºä¾‹
/// å‰ç«¯è°ƒç”¨ç¤ºä¾‹ï¼š
/// ```javascript
/// await invoke('write_to_clipboard', { text: 'Hello World' });
/// ```
///
/// # é”™è¯¯å¤„ç†
/// - `"Failed to create clipboard"` - å‰ªè´´æ¿å®ä¾‹åˆ›å»ºå¤±è´¥
/// - `"Failed to set text"` - å†™å…¥æ–‡æœ¬å¤±è´¥
///
/// # æ³¨æ„äº‹é¡¹
/// - æ­¤å‡½æ•°ä¼šè§¦å‘`is_frontend_copy`æ ‡å¿—ï¼Œé€šçŸ¥ç›‘æ§çº¿ç¨‹å¿½ç•¥æ­¤æ¬¡å¤åˆ¶
/// - å‰ç«¯è°ƒç”¨ååº”ç«‹å³é‡ç½®å‰ªè´´æ¿çŠ¶æ€
#[tauri::command]
pub fn write_to_clipboard(
    text: String,
    _app_handle: tauri::AppHandle,
    state: State<'_, ClipboardSourceState>,
) -> Result<(), String> {
    // è®¾ç½®æ ‡å¿—ï¼Œè¡¨ç¤ºè¿™æ˜¯å‰ç«¯è§¦å‘çš„å¤åˆ¶
    *state.is_frontend_copy.lock().unwrap() = true;

    let mut clipboard = Clipboard::new().map_err(|e| e.to_string())?;
    clipboard.set_text(text).map_err(|e| e.to_string())?;

    Ok(())
}
```

### 2.3 å¼‚æ­¥å‡½æ•°æ³¨é‡Šè§„èŒƒ

```rust
/// OCR è¯†åˆ«å‡½æ•°ï¼Œä½œä¸º Tauri Command æš´éœ²ç»™å‰ç«¯è°ƒç”¨ã€‚
///
/// ä½¿ç”¨é…ç½®çš„OCRå¼•æ“å¯¹æŒ‡å®šå›¾ç‰‡æ–‡ä»¶è¿›è¡Œæ–‡å­—è¯†åˆ«ã€‚
/// è¯¥å‡½æ•°æ˜¯å¼‚æ­¥çš„ï¼Œé¿å…é˜»å¡ä¸»çº¿ç¨‹ã€‚
///
/// # å‚æ•°
/// - `file_path: String` - å›¾åƒæ–‡ä»¶çš„ç»å¯¹è·¯å¾„ã€‚
///   - å¿…é¡»å­˜åœ¨ä¸”å¯è¯»
///   - æ”¯æŒæ ¼å¼ï¼šPNGã€JPGã€BMPç­‰
///
/// # è¿”å›å€¼
/// `Result<String, String>` - è¯†åˆ«ç»“æœï¼š
/// - `Ok(String)` - JSONæ ¼å¼çš„è¯†åˆ«ç»“æœï¼ŒåŒ…å«ç½®ä¿¡åº¦å’Œæ–‡æœ¬
/// - `Err(String)` - è¯†åˆ«å¤±è´¥çš„é”™è¯¯ä¿¡æ¯
///
/// # ç¤ºä¾‹
/// ```rust
/// // Rustç«¯è°ƒç”¨ç¤ºä¾‹
/// match ocr_image("path/to/image.png").await {
///     Ok(text) => println!("è¯†åˆ«ç»“æœ: {}", text),
///     Err(e) => eprintln!("è¯†åˆ«å¤±è´¥: {}", e),
/// }
/// ```
///
/// # é”™è¯¯å¤„ç†
/// - `"OCR engine is not configured"` - OCRå¼•æ“æœªåˆå§‹åŒ–
/// - `"OCR recognition failed: ..."` - è¯†åˆ«è¿‡ç¨‹å¤±è´¥
/// - `"lock error: ..."` - çº¿ç¨‹é”é”™è¯¯
///
/// # æ€§èƒ½è€ƒè™‘
/// - å›¾ç‰‡å°ºå¯¸è¶Šå¤§ï¼Œè¯†åˆ«æ—¶é—´è¶Šé•¿
/// - å»ºè®®åœ¨å‰ç«¯æ˜¾ç¤ºåŠ è½½çŠ¶æ€
/// - è¶…æ—¶æ—¶é—´å¯åœ¨é…ç½®ä¸­è®¾ç½®
#[tauri::command]
pub async fn ocr_image(file_path: String) -> Result<String, String> {
    // å‡½æ•°å®ç°...
}
```

### 2.4 ç»“æ„ä½“æ³¨é‡Šè§„èŒƒ

```rust
/// å‰ªè´´æ¿æ•°æ®é¡¹ç»“æ„ä½“
///
/// è¡¨ç¤ºå‰ªè´´æ¿å†å²ä¸­çš„ä¸€ä¸ªé¡¹ç›®ï¼Œæ”¯æŒæ–‡æœ¬ã€å›¾ç‰‡ã€æ–‡ä»¶ç­‰å¤šç§ç±»å‹ã€‚
/// æ‰€æœ‰å­—æ®µéƒ½æ”¯æŒJSONåºåˆ—åŒ–/ååºåˆ—åŒ–ã€‚
///
/// # å­—æ®µè¯´æ˜
/// - `id: String` - å”¯ä¸€æ ‡è¯†ç¬¦ï¼Œä¸ºUUID v4æ ¼å¼
/// - `item_type: String` - æ•°æ®ç±»å‹ï¼Œå¯é€‰å€¼ï¼š"text"ã€"image"ã€"file"ã€"folder"
/// - `content: String` - æ•°æ®å†…å®¹ï¼š
///   - æ–‡æœ¬ç±»å‹ï¼šå­˜å‚¨æ–‡æœ¬å†…å®¹æœ¬èº«
///   - æ–‡ä»¶/å›¾ç‰‡ç±»å‹ï¼šå­˜å‚¨ç›¸å¯¹è·¯å¾„ï¼ˆç›¸å¯¹äºfilesç›®å½•ï¼‰
/// - `size: Option<u64>` - æ•°æ®å¤§å°ï¼š
///   - æ–‡æœ¬ç±»å‹ï¼šå­—ç¬¦æ•°ï¼ˆéå­—èŠ‚æ•°ï¼‰
///   - æ–‡ä»¶ç±»å‹ï¼šæ–‡ä»¶å­—èŠ‚å¤§å°
///   - å›¾ç‰‡ç±»å‹ï¼šå›¾ç‰‡æ–‡ä»¶å¤§å°
/// - `is_favorite: bool` - æ˜¯å¦ä¸ºæ”¶è—é¡¹
/// - `notes: String` - ç”¨æˆ·æ·»åŠ çš„å¤‡æ³¨ä¿¡æ¯
/// - `timestamp: i64` - åˆ›å»ºæ—¶é—´æˆ³ï¼ˆUnixæ—¶é—´æˆ³ï¼Œæ¯«ç§’ï¼‰
///
/// # åºåˆ—åŒ–ç¤ºä¾‹
/// ```json
/// {
///   "id": "550e8400-e29b-41d4-a716-446655440000",
///   "item_type": "text",
///   "content": "Hello World",
///   "size": 11,
///   "is_favorite": false,
///   "notes": "ç¤ºä¾‹æ–‡æœ¬",
///   "timestamp": 1640995200000
/// }
/// ```
#[derive(Serialize, Deserialize, Debug, Clone, PartialEq)]
pub struct ClipboardItem {
    /// å”¯ä¸€æ ‡è¯†ç¬¦ï¼Œä¸ºUUID v4æ ¼å¼
    pub id: String,
    /// æ•°æ®ç±»å‹ï¼štext/image/file/folder
    pub item_type: String,
    /// æ•°æ®å†…å®¹
    pub content: String,
    /// æ•°æ®å¤§å°
    pub size: Option<u64>,
    /// æ˜¯å¦ä¸ºæ”¶è—é¡¹
    pub is_favorite: bool,
    /// ç”¨æˆ·å¤‡æ³¨
    pub notes: String,
    /// æ—¶é—´æˆ³ï¼ˆæ¯«ç§’ï¼‰
    pub timestamp: i64,
}
```

### 2.5 é…ç½®é¡¹æ³¨é‡Šè§„èŒƒ

```rust
/// ç³»ç»Ÿé…ç½®ç»“æ„ä½“
///
/// åŒ…å«åº”ç”¨çš„æ‰€æœ‰é…ç½®é¡¹ï¼Œæ”¯æŒJSONåºåˆ—åŒ–ã€‚
/// é»˜è®¤å€¼å·²é€šè¿‡Default traitå®ç°ã€‚
///
/// # é…ç½®åˆ†ç±»
/// 1. é€šç”¨è®¾ç½®ï¼ˆGeneralï¼‰
/// 2. å‰ªè´´æ¿å‚æ•°ï¼ˆClipboardï¼‰
/// 3. AIåŠ©æ‰‹ï¼ˆAI Agentï¼‰
/// 4. å®‰å…¨ä¸éšç§ï¼ˆSecurityï¼‰
/// 5. æ•°æ®å¤‡ä»½ï¼ˆBackupï¼‰
/// 6. äº‘ç«¯åŒæ­¥ï¼ˆCloud Syncï¼‰
/// 7. ç”¨æˆ·ä¿¡æ¯ï¼ˆUserï¼‰
/// 8. OCRè®¾ç½®ï¼ˆOCRï¼‰
///
/// # æ³¨æ„äº‹é¡¹
/// - ä¿®æ”¹é…ç½®åéœ€è°ƒç”¨`save_config`æŒä¹…åŒ–
/// - éƒ¨åˆ†é…ç½®éœ€è¦é‡å¯åº”ç”¨ç”Ÿæ•ˆ
/// - é…ç½®è·¯å¾„å¯é€šè¿‡ç¯å¢ƒå˜é‡è¦†ç›–
#[derive(Serialize, Deserialize, Debug, Clone, PartialEq)]
pub struct Config {
    // --- é€šç”¨è®¾ç½® ---
    
    /// æ˜¯å¦å¯ç”¨å¼€æœºè‡ªå¯åŠ¨
    /// - ç±»å‹ï¼š`bool`
    /// - é»˜è®¤å€¼ï¼š`false`
    /// - ç”Ÿæ•ˆæ—¶æœºï¼šä¸‹æ¬¡å¯åŠ¨æ—¶ç”Ÿæ•ˆ
    pub autostart: bool,
    
    /// ç³»ç»Ÿæ‰˜ç›˜å›¾æ ‡æ˜¯å¦å¯è§
    /// - ç±»å‹ï¼š`bool`
    /// - é»˜è®¤å€¼ï¼š`true`
    /// - ç”Ÿæ•ˆæ—¶æœºï¼šç«‹å³ç”Ÿæ•ˆï¼ˆéœ€æ‰˜ç›˜å·²åˆ›å»ºï¼‰
    pub tray_icon_visible: bool,
    
    /// å¯åŠ¨æ—¶æ˜¯å¦æœ€å°åŒ–åˆ°æ‰˜ç›˜
    /// - ç±»å‹ï¼š`bool`
    /// - é»˜è®¤å€¼ï¼š`false`
    /// - ç”Ÿæ•ˆæ—¶æœºï¼šä¸‹æ¬¡å¯åŠ¨æ—¶ç”Ÿæ•ˆ
    pub minimize_to_tray: bool,
    
    // --- å‰ªè´´æ¿å‚æ•° ---
    
    /// æœ€å¤§å†å²è®°å½•æ•°é‡
    /// - ç±»å‹ï¼š`u32`
    /// - é»˜è®¤å€¼ï¼š`500`
    /// - è¯´æ˜ï¼š0è¡¨ç¤ºæ— é™åˆ¶
    /// - ç”Ÿæ•ˆæ—¶æœºï¼šä¸‹æ¬¡æ¸…ç†æ—¶ç”Ÿæ•ˆ
    pub max_history_items: u32,
    
    /// å¿½ç•¥çŸ­æ–‡æœ¬çš„æœ€çŸ­å­—ç¬¦æ•°
    /// - ç±»å‹ï¼š`u32`
    /// - é»˜è®¤å€¼ï¼š`0`
    /// - è¯´æ˜ï¼š0è¡¨ç¤ºä¸å¿½ç•¥çŸ­æ–‡æœ¬
    /// - ç”Ÿæ•ˆæ—¶æœºï¼šç«‹å³ç”Ÿæ•ˆ
    pub ignore_short_text_len: u32,
    
    // ... å…¶ä»–é…ç½®é¡¹ ...
}
```

## ä¸‰ã€ä»£ç æ ¼å¼è§„èŒƒ

### 3.1 å¯¼å…¥é¡ºåº
```rust
// 1. æ ‡å‡†åº“
use std::fs;
use std::io;
use std::path::{Path, PathBuf};
use std::sync::{Arc, Mutex};

// 2. å¤–éƒ¨crate
use chrono::Utc;
use image::ColorType;
use serde_json::Value;
use tauri::{App, AppHandle, Manager};

// 3. å†…éƒ¨æ¨¡å—
use crate::clipboard::ClipboardItem;
use crate::config::{self, CONFIG};
use crate::db;
use crate::utils;
```

### 3.2 é”™è¯¯å¤„ç†è§„èŒƒ
```rust
// æ¨èï¼šä½¿ç”¨?è¿ç®—ç¬¦å’Œmap_err
pub fn load_config() -> Result<Config, String> {
    let data = fs::read_to_string("config.json")
        .map_err(|e| format!("è¯»å–é…ç½®æ–‡ä»¶å¤±è´¥: {}", e))?;
    
    serde_json::from_str(&data)
        .map_err(|e| format!("è§£æé…ç½®æ–‡ä»¶å¤±è´¥: {}", e))
}

// æ¨èï¼šæä¾›ä¸Šä¸‹æ–‡ä¿¡æ¯çš„é”™è¯¯
pub fn process_file(path: &Path) -> Result<Vec<u8>, String> {
    let file = fs::File::open(path)
        .map_err(|e| format!("æ— æ³•æ‰“å¼€æ–‡ä»¶ {}: {}", path.display(), e))?;
    
    // ... å¤„ç†é€»è¾‘
}
```

### 3.3 å¼‚æ­¥å‡½æ•°è§„èŒƒ
```rust
// æ¨èï¼šæ˜ç¡®æ ‡æ³¨asyncå‡½æ•°
#[tauri::command]
pub async fn async_operation(param: String) -> Result<String, String> {
    // è€—æ—¶æ“ä½œä½¿ç”¨spawn_blocking
    let result = tauri::async_runtime::spawn_blocking(move || {
        // é˜»å¡æ“ä½œ
        expensive_operation(param)
    })
    .await
    .map_err(|e| format!("ä»»åŠ¡æ‰§è¡Œå¤±è´¥: {}", e))??;
    
    Ok(result)
}
```

### 3.4 å¸¸é‡å‘½åè§„èŒƒ
```rust
// å…¨å±€å¸¸é‡ï¼šå…¨å¤§å†™ï¼Œä½¿ç”¨OnceLockæˆ–lazy_static
pub static CONFIG: OnceLock<RwLock<Config>> = OnceLock::new();

// æ¨¡å—çº§å¸¸é‡ï¼šå…¨å¤§å†™
const MAX_RETRY_COUNT: u32 = 3;
const DEFAULT_TIMEOUT: Duration = Duration::from_secs(30);

// ç±»å‹åˆ«åï¼šä½¿ç”¨å¸•æ–¯å¡å‘½åæ³•
pub type Result<T> = std::result::Result<T, String>;
```

## å››ã€å®‰å…¨è§„èŒƒ

### 4.1 è·¯å¾„å®‰å…¨
```rust
/// å®‰å…¨çš„è·¯å¾„è§£æå‡½æ•°
///
/// é˜²æ­¢è·¯å¾„éå†æ”»å‡»ï¼ˆPath Traversalï¼‰
///
/// # å‚æ•°
/// - `base_path: &Path` - åŸºç¡€ç›®å½•
/// - `user_input: &str` - ç”¨æˆ·è¾“å…¥çš„ç›¸å¯¹è·¯å¾„
///
/// # è¿”å›å€¼
/// - `Ok(PathBuf)` - å®‰å…¨çš„ç»å¯¹è·¯å¾„
/// - `Err(String)` - è·¯å¾„éæ³•
pub fn safe_join_path(base_path: &Path, user_input: &str) -> Result<PathBuf, String> {
    let joined = base_path.join(user_input);
    
    // æ£€æŸ¥æ˜¯å¦å°è¯•è·³å‡ºåŸºç¡€ç›®å½•
    if joined.canonicalize()?.starts_with(base_path.canonicalize()?) {
        Ok(joined)
    } else {
        Err("éæ³•è·¯å¾„ï¼šå°è¯•è®¿é—®åŸºç¡€ç›®å½•ä¹‹å¤–çš„æ–‡ä»¶".to_string())
    }
}
```

### 4.2 è¾“å…¥éªŒè¯
```rust
/// éªŒè¯å¹¶å¤„ç†ç”¨æˆ·è¾“å…¥
///
/// æ‰€æœ‰ä»å‰ç«¯æ¥æ”¶çš„æ•°æ®éƒ½åº”éªŒè¯
pub fn validate_user_input(input: &str) -> Result<String, String> {
    // 1. æ£€æŸ¥é•¿åº¦
    if input.len() > 10000 {
        return Err("è¾“å…¥è¿‡é•¿".to_string());
    }
    
    // 2. æ£€æŸ¥ç‰¹æ®Šå­—ç¬¦
    if input.contains('\0') {
        return Err("è¾“å…¥åŒ…å«éæ³•å­—ç¬¦".to_string());
    }
    
    // 3. æ¸…ç†è¾“å…¥
    let cleaned = input.trim().to_string();
    
    Ok(cleaned)
}
```

## äº”ã€æ€§èƒ½è§„èŒƒ

### 5.1 é¿å…é˜»å¡ä¸»çº¿ç¨‹
```rust
// æ¨èï¼šæ–‡ä»¶æ“ä½œä½¿ç”¨spawn_blocking
pub async fn read_large_file(path: &Path) -> Result<Vec<u8>, String> {
    let path = path.to_path_buf();
    tauri::async_runtime::spawn_blocking(move || {
        fs::read(path).map_err(|e| e.to_string())
    })
    .await
    .map_err(|e| format!("å¼‚æ­¥ä»»åŠ¡å¤±è´¥: {}", e))?
}
```

### 5.2 å†…å­˜ç®¡ç†
```rust
// æ¨èï¼šä½¿ç”¨è¿­ä»£å™¨é¿å…ä¸­é—´åˆ†é…
pub fn process_items(items: &[ClipboardItem]) -> Vec<String> {
    items
        .iter()
        .filter(|item| item.is_favorite)
        .map(|item| item.content.clone())
        .collect()
}
```

## å…­ã€æµ‹è¯•è§„èŒƒ

### 6.1 å•å…ƒæµ‹è¯•ä½ç½®
```rust
// æ¯ä¸ªæ¨¡å—å¯¹åº”ä¸€ä¸ªæµ‹è¯•æ–‡ä»¶
#[cfg(test)]
#[path = "test_unit/test_app_setup.rs"]
mod test_app_setup;

// æµ‹è¯•æ–‡ä»¶ç»“æ„
// src/
//   â”œâ”€â”€ app_setup.rs
//   â””â”€â”€ test_unit/
//         â”œâ”€â”€ test_app_setup.rs
//         â”œâ”€â”€ test_config.rs
//         â”œâ”€â”€ test_db_adv.rs
//         â”œâ”€â”€ test_db_base.rs
//         â”œâ”€â”€ test_db_cleanup.rs
//         â”œâ”€â”€ test_db_extend.rs
//         â”œâ”€â”€ test_db_folder.rs
//         â”œâ”€â”€ test_db_private.rs
//         â”œâ”€â”€ test_db_sync.rs
//         â”œâ”€â”€ test_ocr.rs
//         â”œâ”€â”€ test_performance.rs
//         â””â”€â”€ test_utils.rs
```



## ä¸ƒã€Gitæäº¤è§„èŒƒ


- **init**: é¡¹ç›®åˆå§‹åŒ–
- **feat**: æ–°åŠŸèƒ½ï¼ˆfeatureï¼‰
- **perf**: ä¼˜åŒ–ç›¸å…³ï¼Œå¦‚æ€§èƒ½æå‡ã€ä½“éªŒ
- **fix**: ä¿®å¤bug
- **docs**: æ–‡æ¡£æ›´æ–°
- **style**: ä»£ç æ ¼å¼è°ƒæ•´ï¼ˆä¸å½±å“åŠŸèƒ½ï¼‰
- **refactor**: ä»£ç é‡æ„
- **test**: æµ‹è¯•ç›¸å…³
- **chore**: æ„å»ºè¿‡ç¨‹æˆ–è¾…åŠ©å·¥å…·å˜åŠ¨
- **build**: ä¾èµ–ç›¸å…³
- **ci**: é…ç½®ç›¸å…³
- **revert**: å›æ»šä¸Šä¸€ä¸ªç‰ˆæœ¬





## å…«ã€æ—¥å¿—è§„èŒƒ

### 8.1 æ—¥å¿—çº§åˆ«ä½¿ç”¨
```rust
// ä½¿ç”¨ä¸åŒçš„æ‰“å°å‡½æ•°è¡¨ç¤ºæ—¥å¿—çº§åˆ«
println!("â„¹ï¸ ä¿¡æ¯: {}", message);      // æ™®é€šä¿¡æ¯
println!("âœ… æˆåŠŸ: {}", message);      // æˆåŠŸæ“ä½œ
println!("âš ï¸ è­¦å‘Š: {}", message);      // è­¦å‘Šä¿¡æ¯
eprintln!("âŒ é”™è¯¯: {}", message);     // é”™è¯¯ä¿¡æ¯
eprintln!("ğŸ”§ è°ƒè¯•: {}", message);     // è°ƒè¯•ä¿¡æ¯ï¼ˆè°ƒè¯•æ¨¡å¼ï¼‰
```

### 8.2 æ—¥å¿—æ ¼å¼
```rust
// åŒ…å«æ—¶é—´æˆ³å’Œæ¨¡å—ä¿¡æ¯
pub fn log_info(module: &str, message: &str) {
    let timestamp = chrono::Local::now().format("%Y-%m-%d %H:%M:%S");
    println!("[{}] [{}] â„¹ï¸ {}", timestamp, module, message);
}

// ä½¿ç”¨ç¤ºä¾‹
log_info("config", "é…ç½®æ–‡ä»¶åŠ è½½æˆåŠŸ");
```
