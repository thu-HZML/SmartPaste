# 软件测试报告

## 一. 单元测试/功能测试

### 1. 本地Rust后端测试

**测试覆盖范围（功能模块）**

- 启动与初始化：应用初始化、运行环境与数据库初始化流程
- 剪贴板核心：剪贴板数据结构、读写与基础逻辑
- 配置模块：配置读取/写入/校验相关逻辑
- 数据库模块（db）：核心数据表操作、扩展数据、收藏夹、隐私标记、搜索、同步、清理策略
- OCR 模块：OCR 相关处理流程
- 工具模块：通用工具函数（覆盖率偏低，后续可补测）

**单元测试结果**

- 总体行覆盖率：**67.87%（4756/7007）**
- DB 子模块保持较高行覆盖率（多在 **80%+**），单元测试文件自身行覆盖率普遍在 **90%+**。

**测试报告（行覆盖率）**

| 类型     | 功能模块/测试集 | 文件                | 行覆盖率         | 备注                          |
| -------- | --------------- | ------------------- | ---------------- | ----------------------------- |
| 被测代码 | 启动与初始化    | app_setup.rs        | 8.84% (62/701)   | 初始化流程覆盖偏低            |
| 被测代码 | 剪贴板核心      | clipboard.rs        | 75.76% (25/33)   | 核心逻辑覆盖良好              |
| 被测代码 | 配置模块        | config.rs           | 60.98% (425/697) | 覆盖中等                      |
| 被测代码 | DB-清理策略     | cleanup.rs          | 85.51% (59/69)   | 清理逻辑覆盖较高              |
| 被测代码 | DB-核心 CRUD    | core.rs             | 83.64% (404/483) | 核心数据库操作覆盖较高        |
| 被测代码 | DB-扩展数据     | extended.rs         | 80.41% (78/97)   | OCR/图标等扩展字段相关        |
| 被测代码 | DB-收藏夹       | folders.rs          | 80.47% (136/169) | 收藏夹与关联表逻辑覆盖较高    |
| 被测代码 | DB-初始化与导出 | mod.rs              | 90.32% (56/62)   | 表结构初始化覆盖高            |
| 被测代码 | DB-隐私         | privacy.rs          | 81.91% (548/669) | 隐私标记、加解密/导入导出相关 |
| 被测代码 | DB-搜索         | search.rs           | 83.78% (62/74)   | 综合搜索逻辑覆盖较高          |
| 被测代码 | DB-同步         | sync.rs             | 80.00% (116/145) | 云端同步/解密同步相关         |
| 被测代码 | OCR 模块        | ocr.rs              | 80.00% (76/95)   | OCR 流程覆盖较高              |
| 被测代码 | 工具模块        | utils.rs            | 18.00% (151/839) | 覆盖偏低（建议后续补测）      |
| 被测代码 | 库入口          | lib.rs              | 0.00% (0/22)     | 入口/装配代码未被单测直接覆盖 |
| 被测代码 | 主入口          | main.rs             | 0.00% (0/163)    | 入口/装配代码未被单测直接覆盖 |
| 单元测试 | AppSetup 测试   | test_app_setup.rs   | 100.00% (63/63)  | 测试代码行覆盖率              |
| 单元测试 | Config 测试     | test_config.rs      | 96.15% (375/390) | 测试代码行覆盖率              |
| 单元测试 | DB-高级测试     | test_db_adv.rs      | 94.86% (332/350) | 测试代码行覆盖率              |
| 单元测试 | DB-基础测试     | test_db_base.rs     | 96.39% (347/360) | 测试代码行覆盖率              |
| 单元测试 | DB-清理测试     | test_db_cleanup.rs  | 96.15% (25/26)   | 测试代码行覆盖率              |
| 单元测试 | DB-扩展测试     | test_db_extend.rs   | 92.93% (92/99)   | 测试代码行覆盖率              |
| 单元测试 | DB-收藏夹测试   | test_db_folder.rs   | 93.56% (247/264) | 测试代码行覆盖率              |
| 单元测试 | DB-隐私测试     | test_db_private.rs  | 96.20% (405/421) | 测试代码行覆盖率              |
| 单元测试 | DB-同步测试     | test_db_sync.rs     | 99.32% (441/444) | 测试代码行覆盖率              |
| 单元测试 | OCR 测试        | test_ocr.rs         | 96.00% (48/50)   | 测试代码行覆盖率              |
| 单元测试 | 性能测试        | test_performance.rs | 89.74% (35/39)   | 测试代码行覆盖率              |
| 单元测试 | 工具测试        | test_utils.rs       | 80.87% (148/183) | 测试代码行覆盖率              |



### 2. 云端Django后端

**测试覆盖范围（功能模块）**

- **用户账户模块 (Accounts)**：涵盖用户模型定义、JWT 认证工具、API 视图处理、数据序列化及输入验证逻辑。
- **AI 助手模块 (AI Assistant)**：涵盖 AI 相关的数据模型、辅助工具函数及交互视图。
- **同步模块 (Sync)**：涵盖核心数据库操作、同步数据模型、API 视图及序列化逻辑，是后端核心业务逻辑。
- **核心配置 (App)**：涵盖项目全局设置与路由配置。
- **通用工具 (Utils/Tools)**：涵盖 JWT 核心实现及管理命令工具。

**单元测试结果**

- **总体行覆盖率**：**94%**（1891/2021）
- **核心模块表现**：
  - **Sync（同步）模块**：作为核心业务，其模型 (`models.py`) 达到 100% 覆盖，视图 (`views.py`) 达到 92%，数据库操作 (`db.py`) 保持在 85% 的高水位。
  - **Accounts（账户）模块**：模型与序列化均在 95% 以上，确保了用户数据的安全性与准确性。
  - **测试代码质量**：所有单元测试文件 (`test_*.py` 或 `tests.py`) 的自身覆盖率极高（96%-100%），证明测试用例本身逻辑完整。

**测试报告（行覆盖率）**

| 类型         | 功能模块/测试集          | 文件                         | 行覆盖率       | 备注                       |
| ------------ | ------------------------ | ---------------------------- | -------------- | -------------------------- |
| **被测代码** | **用户账户-模型**        | `accounts/models.py`         | 95% (20/21)    | 用户数据模型覆盖高         |
| **被测代码** | **用户账户-****序列化**  | `accounts/serializers.py`    | 96% (51/53)    | 数据序列化逻辑覆盖高       |
| **被测代码** | **用户账户-视图**        | `accounts/views.py`          | 87% (114/131)  | 认证与用户接口覆盖良好     |
| **被测代码** | **用户账户-验证器**      | `accounts/validators.py`     | 69% (18/26)    | 输入验证逻辑覆盖中等       |
| **被测代码** | **AI助手-工具**          | `ai_assistant/utils.py`      | 90% (37/41)    | AI 辅助工具函数覆盖高      |
| **被测代码** | **AI助手-视图**          | `ai_assistant/views.py`      | 68% (60/88)    | AI 交互接口覆盖中等        |
| **被测代码** | **全局配置**             | `app/settings.py`            | 100% (45/45)   | 项目配置完全覆盖           |
| **被测代码** | **同步-数据库操作**      | `sync/db.py`                 | 85% (157/185)  | 核心数据库同步逻辑覆盖良好 |
| **被测代码** | **同步-模型**            | `sync/models.py`             | 100% (49/49)   | 同步数据模型完全覆盖       |
| **被测代码** | **同步-视图**            | `sync/views.py`              | 92% (149/162)  | 同步接口逻辑覆盖高         |
| **被测代码** | **通用工具-****JWT**     | `utils/jwt.py`               | 97% (183/188)  | JWT 认证工具覆盖极高       |
| **单元测试** | **账户-****JWT****测试** | `accounts/test_jwt_utils.py` | 96% (233/242)  | 测试代码行覆盖率           |
| **单元测试** | **账户-综合测试**        | `accounts/tests.py`          | 100% (111/111) | 测试代码行覆盖率           |
| **单元测试** | **AI助手-工具测试**      | `ai_assistant/test_utils.py` | 100% (61/61)   | 测试代码行覆盖率           |
| **单元测试** | **AI助手-综合测试**      | `ai_assistant/tests.py`      | 100% (52/52)   | 测试代码行覆盖率           |
| **单元测试** | **同步-覆盖率测试**      | `sync/test_coverage.py`      | 97% (140/145)  | 测试代码行覆盖率           |
| **单元测试** | **同步-视图测试**        | `sync/test_views.py`         | 100% (134/134) | 测试代码行覆盖率           |
| **单元测试** | **同步-综合测试**        | `sync/tests.py`              | 96% (197/205)  | 测试代码行覆盖率           |
| **单元测试** | **工具-综合测试**        | `tools/tests.py`             | 100% (28/28)   | 测试代码行覆盖率           |



## 二. 性能测试

项目在交付前完成了面向服务器端 API 的黑盒并发性能验证。

- 核心目标：验证在多并发请求下系统的稳定性（无明显 5xx/崩溃）、吞吐能力与尾延迟表现
- 测试方式：采用阶梯加压（Step Load）方式，选取代表性接口 GET /api/sync/sqlite/get/ 作为压测目标，固定每档持续 10s，并发从 20 开始按步长 20 逐级提升，最大到 300；每档统计 rps、p95、5xx_rate、状态码分布与客户端异常数，并设置阈值 5xx_rate<=1%、p95<=1500ms，超过阈值即停止加压。
- 测试实现：测试脚本使用 pytest + aiohttp 实现，参见 云端仓库`backend/test/test_concurrent.py`。
- 测试结果：
  - 在并发 20~200 的区间内接口均返回 200（5xx_rate=0），吞吐稳定在约 140–158 rps，p95 随并发升高逐步上升，在并发 200 时 p95=1473ms 仍满足阈值；
  - 当并发提升到 220 时 p95=1700ms 超过阈值触发停止
  - 由此可见，在本次部署与网络条件、以及上述阈值约束下，该接口可稳定支撑约 200 并发（区间约 [200,220)），对应吞吐约 158 rps。同时，非压力的并发回归用例运行结果为 6 passed（验证配置/文件等关键行为逻辑在并发下可用）。



## 三. 自动化测试

使用Apifox的自动化测试工具，借助api文档直接生成自动化测试用例，测试单个用户的全部行为逻辑。

经配置参数，合理设置断言后，测试全部通过，结果如下图所示。

![img](https://ucntu4ty532p.feishu.cn/space/api/box/stream/download/asynccode/?code=OTRjYWRhYzc3ODc1MmU5ZWVkZjgxNzViMzQxNzNlMzJfWUNVMnRqSHpEWTlyRkpjS2JxUzRmSFJLN2VJTm9kQXdfVG9rZW46S2gyZGJ4U05lb3l0R2J4RDdvdGNhYUV4blVkXzE3NjcyNTE1Nzg6MTc2NzI1NTE3OF9WNA)